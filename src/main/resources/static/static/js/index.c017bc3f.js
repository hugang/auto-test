(()=>{"use strict";var e={5074:function(e,t,r){var n=r(5893),a=r(745),l=r(7294),i=r(9508),o=r(9181),s=r(3991),d=r(8077);let c=e=>{let{node:t,depth:r,text:a}=e;return(0,n.jsx)(s.Z,{className:"placeholder-component",sx:{marginLeft:3*(r||0),px:2,py:1,bgcolor:"primary.50",border:"1px dashed",borderColor:"primary.200",borderRadius:1,color:"primary.600",fontStyle:"italic",display:"inline-block",boxShadow:"0 0 5px rgba(0, 0, 0, 0.05)",transition:"all 0.2s ease",width:"calc(100% - "+3*(r||0)+"px - 16px)",maxWidth:"600px",animation:"pulse 1.5s infinite ease-in-out","@keyframes pulse":{"0%":{opacity:.7},"50%":{opacity:1},"100%":{opacity:.7}}},children:(0,n.jsx)(d.Z,{variant:"body2",component:"span",children:a||"放置在这里..."})})};var u=r(9126),p=r(3400),f=r(8500),m=r(8033),h=r(7230);let x=["if","elseIf","else","times","section","click","type","wait","open","setProperty","setWindowSize","select","scroll"],g=e=>{let{command:t,target:r,value:a,comment:i,onChange:o,onOk:c,onCancel:g}=e;return(0,l.useEffect)(()=>{let e=e=>{e.altKey&&"Enter"===e.key&&c()};return document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)}},[c]),(0,n.jsxs)(u.Z,{elevation:0,sx:{padding:3,minWidth:350},children:[(0,n.jsx)(d.Z,{variant:"h6",mb:2,color:"primary",children:"编辑命令"}),(0,n.jsxs)(p.Z,{spacing:2,children:[(0,n.jsx)(f.Z,{freeSolo:!0,options:x,value:t||"",onChange:(e,t)=>o("command",t),inputValue:t||"",onInputChange:(e,t)=>o("command",t),renderInput:e=>(0,n.jsx)(m.Z,{...e,fullWidth:!0,label:"命令",variant:"outlined",size:"small",helperText:"选择或输入一个命令"})}),(0,n.jsx)(m.Z,{fullWidth:!0,label:"目标",variant:"outlined",size:"small",value:r,onChange:e=>o("target",e.target.value)}),(0,n.jsx)(m.Z,{fullWidth:!0,label:"值",variant:"outlined",size:"small",value:a,onChange:e=>o("value",e.target.value),multiline:!0,minRows:3}),(0,n.jsx)(m.Z,{fullWidth:!0,label:"注释",variant:"outlined",size:"small",value:i,onChange:e=>o("comment",e.target.value)}),(0,n.jsxs)(s.Z,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mt:1},children:[(0,n.jsx)(d.Z,{variant:"caption",color:"text.secondary",children:"提示: 按下 Alt+Enter 快速提交"}),(0,n.jsxs)(s.Z,{sx:{display:"flex",gap:1},children:[(0,n.jsx)(h.Z,{variant:"outlined",onClick:g,children:"取消"}),(0,n.jsx)(h.Z,{variant:"contained",color:"primary",onClick:c,children:"确定"})]})]})]})]})};var y=r(8106),v=r(488),j=r(1035),b=r(3422),Z=r(3168),C=r(9467),F=r(5512),k=r(1215),S=r(1419),w=r(4540),E=r(7454),O=r(4258),I=r(9599),D=r(2703),z=r(5901),B=r(7597),L=r.n(B);let P=(0,r(8530).Z)({palette:{primary:{main:"#008756",dark:"#006942",light:"#33a97b",contrastText:"#fff",disabled:"#b6e5d0"},secondary:{main:"#00a758"},success:{main:"#41C27C"},warning:{main:"#FFA940"},error:{main:"#F5483B"},info:{main:"#1890FF"},text:{primary:"#333333",secondary:"#666666",disabled:"#BFBFBF"},background:{default:"#F7F8FA",paper:"#FFFFFF",card:"#FFFFFF",popup:"#FFFFFF",emphasis:"#E6FAF3"},divider:"#F0F0F0",border:"#E5E6EB",action:{hover:"#83f4c8",selected:"#00a758",disabled:"#BFBFBF",active:"#006942"}},typography:{fontFamily:"Noto Sans SC,Noto Sans TC,Noto Sans JP,Microsoft YaHei,PingFang SC,Hiragino Sans,Hiragino Kaku Gothic Pro,Meiryo,sans-serif",allVariants:{color:"#222222"}},shape:{borderRadius:8}});if("undefined"!=typeof document){let e=document.createElement("link");e.rel="stylesheet",e.href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;700&family=Noto+Sans+TC:wght@400;700&family=Noto+Sans+JP:wght@400;700&display=swap",document.head.appendChild(e)}let R=["if","elseIf","else","times","section"];function N(e){let t=e.filter(e=>0===e.parent),r=[];for(let n=0;n<t.length;n++)r=r.concat(function t(r){let n=[];if(!r.data)return n;if(r.droppable)if(["if","elseIf","else"].includes(r.data.command))if("if"!==r.data.command)return[];else{let n=r.parent,a=e.filter(e=>e.parent===n),l=[],i=!1;for(let e=0;e<a.length;e++)if(a[e].id===r.id&&(i=!0),i&&a[e].data&&["if","elseIf","else"].includes(a[e].data.command))l.push(a[e]);else if(i)break;if(l.length>0&&l[0].id===r.id){let r=[];for(let n of l)for(let a of(r.push({...n.data}),e.filter(e=>e.parent===n.id)))r=r.concat(t(a));return r.push({command:"end",comment:"end if"}),r}return[]}else{for(let a of(n.push({...r.data}),e.filter(e=>e.parent===r.id)))n=n.concat(t(a));n.push({command:"end",comment:`end ${r.data.command||""}`})}else n.push({...r.data});return n}(t[n]));return{name:L().generate(),tests:[{name:L().generate(),commands:r}]}}var $=r(9814),_=r(4115);a.createRoot(document.getElementById("root")).render((0,n.jsxs)($.Z,{theme:P,children:[(0,n.jsx)(_.ZP,{}),(0,n.jsx)(()=>{let[e,t]=(0,l.useState)([]),[r,a]=(0,l.useState)(!1),[p,f]=(0,l.useState)(null),[m,x]=(0,l.useState)("add"),[B,P]=(0,l.useState)({command:"",target:"",value:"",comment:""}),[$,_]=(0,l.useState)(null),[A,W]=(0,l.useState)({open:!1,message:"",severity:"success"}),[T,J]=(0,l.useState)(!1),[U,K]=(0,l.useState)(null),M=()=>{W(e=>({...e,open:!1}))},H=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"success";W({open:!0,message:e,severity:t})};(0,l.useEffect)(()=>{let e=localStorage.getItem("treeData");if(e)try{t(JSON.parse(e))}catch{}},[]),(0,l.useEffect)(()=>{localStorage.setItem("treeData",JSON.stringify(e))},[e]),(0,l.useEffect)(()=>{let n=n=>{if(!r){if(n.ctrlKey&&"c"===n.key.toLowerCase()){if($){let t=e.find(e=>e.id===$);t&&(K(t),H("命令已复制到剪贴板","success"))}return}if(n.ctrlKey&&"v"===n.key.toLowerCase()){if(U){let r=0;if($){let t=e.find(e=>e.id===$);t&&t.droppable&&(r=t.id)}let n=(t,r)=>{let a=L().generate(),l={...t,id:a,parent:r,text:t.text+" (粘贴)"},i=e.filter(e=>e.parent===t.id),o=[l];for(let e of i)o=o.concat(n(e,a));return o};t([...e,...n(U,r)]),H("命令已粘贴","success")}return}if("Escape"===n.key)return void _(null);if("Delete"===n.key)return void($?Q($):H("请先选择要删除的命令","warning"));if(n.altKey)if("n"===n.key){n.preventDefault();let t=e.find(e=>e.id===$);t&&t.droppable?G("add",t):Y()}else if("e"===n.key){n.preventDefault();let t=e.find(e=>e.id===$);t?G("edit",t):H("请先选择要编辑的命令","warning")}else"d"===n.key&&(n.preventDefault(),$?Q($):H("请先选择要删除的命令","warning"))}};return document.addEventListener("keydown",n),()=>{document.removeEventListener("keydown",n)}},[e,$,r,U]);let G=(e,t)=>{x(e),f(t),_((null==t?void 0:t.id)||null),"edit"===e&&t&&t.data?P({...t.data}):P({command:"",target:"",value:"",comment:""}),a(!0)},V=()=>{a(!1),f(null),P({command:"",target:"",value:"",comment:""})},Y=()=>{x("add-root"),f(null),_(null),P({command:"",target:"",value:"",comment:""}),a(!0)},q=e=>{_(e.id)},Q=r=>{if(!r)return;let n=e.find(e=>e.id===r);if(!n)return;let a=t=>{let r=[];return e.filter(e=>e.parent===t).forEach(e=>{r.push(e.id),r.push(...a(e.id))}),r},l=[r,...a(r)];t(e.filter(e=>!l.includes(e.id))),_(null),H(`\u{5DF2}\u{5220}\u{9664} "${n.text}" \u{547D}\u{4EE4}${l.length>1?"及其子命令":""}`,"success")};function X(t){let r=null;for(let l=0;l<t.length;l++){var n,a;let i=null==(a=t[l])||null==(n=a.data)?void 0:n.command;if("elseIf"===i){if("if"!==r&&"elseIf"!==r)return{error:`elseIf \u{5FC5}\u{987B}\u{7D27}\u{8DDF}\u{5728} if \u{6216} elseIf \u{4E4B}\u{540E} (\u{7B2C}${l+1}\u{4E2A}\u{547D}\u{4EE4})`,nodeId:t[l].id};r="elseIf"}else if("else"===i){if("if"!==r&&"elseIf"!==r)return{error:`else \u{5FC5}\u{987B}\u{7D27}\u{8DDF}\u{5728} if \u{6216} elseIf \u{4E4B}\u{540E} (\u{7B2C}${l+1}\u{4E2A}\u{547D}\u{4EE4})`,nodeId:t[l].id};r="else"}else r="if"===i?"if":null;let o=t[l].id?e.filter(e=>e.parent===t[l].id):[];if(o.length>0){let e=X(o);if(e)return e}}return null}return(0,n.jsxs)(y.Z,{maxWidth:"md",children:[(0,n.jsxs)(s.Z,{sx:{my:3},children:[(0,n.jsxs)(s.Z,{sx:{display:"flex",gap:1,mb:2},children:[(0,n.jsx)(h.Z,{variant:"outlined",startIcon:(0,n.jsx)(S.Z,{}),onClick:Y,size:"small",children:"新增根节点"}),(0,n.jsxs)(h.Z,{variant:"outlined",startIcon:(0,n.jsx)(O.Z,{}),component:"label",size:"small",children:["导入数据",(0,n.jsx)("input",{type:"file",accept:"application/json",hidden:!0,onChange:r=>{let n=r.target.files&&r.target.files[0];if(!n)return;let a=new FileReader;a.onload=r=>{try{let n=JSON.parse(r.target.result);if(!Array.isArray(n))return void H("导入的文件格式不正确","error");let a={},l=(e,t)=>{let r=[];return e.forEach(e=>{let i=L().generate();a[e.id]=i;let o={...e,id:i,parent:t,text:e.text+" (导入)"};r.push(o);let s=n.filter(t=>t.parent===e.id);s.length>0&&(r=r.concat(l(s,i)))}),r},i=0;if($){let t=e.find(e=>e.id===$);t&&t.droppable&&(i=t.id)}let o=n.filter(e=>0===e.parent),s=l(o,i);t(e=>[...e,...s]),H("导入成功","success")}catch{H("导入失败，文件内容不是有效的JSON","error")}},a.readAsText(n),r.target.value=""}})]}),(0,n.jsx)(h.Z,{variant:"outlined",startIcon:(0,n.jsx)(I.Z,{}),size:"small",onClick:()=>{let t=X(e.filter(e=>0===e.parent));if(t){_(t.nodeId),H(t.error,"error");return}let r=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),n=URL.createObjectURL(r),a=document.createElement("a");a.href=n,a.download="treeData.json",a.click(),URL.revokeObjectURL(n),H("导出成功","success")},children:"导出数据"}),(0,n.jsx)(h.Z,{variant:"outlined",startIcon:(0,n.jsx)(I.Z,{}),size:"small",onClick:()=>{let t=X(e.filter(e=>0===e.parent));if(t){_(t.nodeId),H(t.error,"error");return}let r=new Blob([JSON.stringify(N(e),null,2)],{type:"application/json"}),n=URL.createObjectURL(r),a=document.createElement("a");a.href=n,a.download="exported-data.json",a.click(),URL.revokeObjectURL(n),H("节点data已导出","success")},children:"导出节点data"}),(0,n.jsx)(h.Z,{variant:"outlined",startIcon:(0,n.jsx)(z.Z,{}),size:"small",style:{marginLeft:8},onClick:async()=>{J(!0);let t=N(e);try{let e=await fetch("http://localhost:9191/flow",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),r=await e.json();H("命令执行成功: "+(r.message||"已提交"),"success")}catch(e){H("命令执行失败: "+(e.message||e),"error")}finally{J(!1)}},children:"执行命令"})]}),(0,n.jsx)(s.Z,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:(0,n.jsx)(d.Z,{variant:"h6",children:"命令树"})})]}),e.length>0&&(0,n.jsx)(u.Z,{elevation:2,sx:{p:2,mb:4,borderRadius:2},children:(0,n.jsx)(o.W,{backend:i.Am,options:(0,i.bK)(),children:(0,n.jsx)(i.mp,{tree:e,onDrop:e=>t(e),rootId:0,sort:!1,insertDroppableFirst:!1,canDrop:(e,t)=>{let{dragSource:r,dropTargetId:n}=t;if((null==r?void 0:r.parent)===n)return!0},initialOpen:!0,dropTargetOffset:5,placeholderRender:(e,t)=>{let{depth:r}=t;return(0,n.jsx)(c,{node:e,depth:r})},render:(r,a)=>{let{depth:l,isOpen:i,onToggle:o}=a,c=r.data&&(r.data.target||r.data.value)?`\u{FF08}${r.data.target||""} ${r.data.value||""}\u{FF09}`:"",u=r.data?`${r.data.command||""} ${r.data.comment||""} ${c}`.trim():r.text,p=r.id===$;return(0,n.jsxs)(s.Z,{onClick:()=>q(r),onDoubleClick:()=>G("edit",r),sx:{display:"flex",alignItems:"center",py:1,pl:3*l,pr:1,my:.5,borderRadius:1,border:p?"2px solid":"1px solid",borderColor:p?"primary.main":"transparent",boxShadow:p?"0 0 4px rgba(25, 118, 210, 0.5)":"none",cursor:"pointer",transition:"all 0.2s","&:hover":{bgcolor:"action.hover"}},children:[r.droppable&&(0,n.jsx)("span",{onClick:o,children:i?"[-]":"[+]"}),(0,n.jsx)(d.Z,{sx:{flexGrow:1,fontWeight:r.droppable?"medium":"normal",color:p?"primary.main":"text.primary"},children:u}),(0,n.jsxs)(s.Z,{sx:{display:"flex",gap:.5},children:[r.droppable&&(0,n.jsx)(v.Z,{title:"添加子命令",children:(0,n.jsx)(j.Z,{size:"small",color:"primary",onClick:e=>{e.stopPropagation(),G("add",r)},children:(0,n.jsx)(S.Z,{fontSize:"small"})})}),(0,n.jsx)(v.Z,{title:"复制命令",children:(0,n.jsx)(j.Z,{size:"small",color:"secondary",onClick:n=>{n.stopPropagation();let a=L().generate();t([...e,{...r,id:a,text:r.text+" (复制)",parent:r.parent}]),H("命令已复制","success")},children:(0,n.jsx)(D.Z,{fontSize:"small"})})}),(0,n.jsx)(v.Z,{title:"编辑命令",children:(0,n.jsx)(j.Z,{size:"small",color:"secondary",onClick:e=>{e.stopPropagation(),G("edit",r)},children:(0,n.jsx)(w.Z,{fontSize:"small"})})}),(0,n.jsx)(v.Z,{title:"删除命令",children:(0,n.jsx)(j.Z,{size:"small",sx:{color:e=>e.palette.text.secondary,border:"1px solid",borderColor:e=>e.palette.border,backgroundColor:"transparent","&:hover":{bgcolor:e=>e.palette.action.hover,color:e=>e.palette.text.primary,borderColor:e=>e.palette.text.primary}},onClick:e=>{e.stopPropagation(),Q(r.id)},children:(0,n.jsx)(E.Z,{fontSize:"small"})})})]})]})}})})}),(0,n.jsx)(b.Z,{open:r,onClose:V,slotProps:{paper:{sx:{width:"90%",maxWidth:"600px",borderRadius:2,padding:2}}},children:(0,n.jsx)(g,{command:B.command,target:B.target,value:B.value,comment:B.comment,onChange:(e,t)=>P(r=>({...r,[e]:t})),onOk:()=>{if("add"===m&&p){let r=L().generate(),n=R.includes((B.command||"").toLowerCase())||R.includes(B.command);t([...e,{id:r,parent:p.id,text:B.command||`\u{65B0}\u{8282}\u{70B9}${r}`,droppable:n,data:{...B}}])}else if("edit"===m&&p){let r=R.includes((B.command||"").toLowerCase())||R.includes(B.command);t(e.map(e=>e.id===p.id?{...e,data:{...B},text:B.command||e.text,droppable:r}:e))}else if("add-root"===m){let r=L().generate(),n=R.includes((B.command||"").toLowerCase())||R.includes(B.command);t([...e,{id:r,parent:0,text:B.command||`\u{65B0}\u{4E00}\u{7EA7}\u{8282}\u{70B9}${r}`,droppable:n,data:{...B}}])}V()},onCancel:V})}),(0,n.jsx)(Z.Z,{open:A.open,autoHideDuration:6e3,onClose:M,children:(0,n.jsx)(C.Z,{onClose:M,severity:A.severity,sx:{width:"100%"},children:A.message})}),(0,n.jsx)(F.Z,{open:T,sx:{color:"#fff",zIndex:e=>e.zIndex.drawer+2},children:(0,n.jsxs)(s.Z,{sx:{display:"flex",flexDirection:"column",alignItems:"center"},children:[(0,n.jsx)(k.Z,{color:"inherit",size:60,thickness:4}),(0,n.jsx)(d.Z,{variant:"h6",sx:{mt:3,letterSpacing:2},children:"正在执行命令，请稍候..."})]})})]})},{})]}))}},t={};function r(n){var a=t[n];if(void 0!==a)return a.exports;var l=t[n]={exports:{}};return e[n](l,l.exports,r),l.exports}r.m=e,r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},(()=>{var e,t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__;r.t=function(n,a){if(1&a&&(n=this(n)),8&a||"object"==typeof n&&n&&(4&a&&n.__esModule||16&a&&"function"==typeof n.then))return n;var l=Object.create(null);r.r(l);var i={};e=e||[null,t({}),t([]),t(t)];for(var o=2&a&&n;"object"==typeof o&&!~e.indexOf(o);o=t(o))Object.getOwnPropertyNames(o).forEach(e=>{i[e]=()=>n[e]});return i.default=()=>n,r.d(l,i),l}})(),r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e=[];r.O=(t,n,a,l)=>{if(n){l=l||0;for(var i=e.length;i>0&&e[i-1][2]>l;i--)e[i]=e[i-1];e[i]=[n,a,l];return}for(var o=1/0,i=0;i<e.length;i++){for(var[n,a,l]=e[i],s=!0,d=0;d<n.length;d++)(!1&l||o>=l)&&Object.keys(r.O).every(e=>r.O[e](n[d]))?n.splice(d--,1):(s=!1,l<o&&(o=l));if(s){e.splice(i--,1);var c=a();void 0!==c&&(t=c)}}return t}})(),r.rv=()=>"1.3.12",(()=>{var e={980:0};r.O.j=t=>0===e[t];var t=(t,n)=>{var a,l,[i,o,s]=n,d=0;if(i.some(t=>0!==e[t])){for(a in o)r.o(o,a)&&(r.m[a]=o[a]);if(s)var c=s(r)}for(t&&t(n);d<i.length;d++)l=i[d],r.o(e,l)&&e[l]&&e[l][0](),e[l]=0;return r.O(c)},n=self.webpackChunkat_designer=self.webpackChunkat_designer||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})(),r.ruid="bundler=rspack@1.3.12";var n=r.O(void 0,["361","86"],function(){return r(5074)});n=r.O(n)})();